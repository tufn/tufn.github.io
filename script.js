const supabase=supabase.createClient("https://hadkdtctdwwoucpyonob.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhhZGtkdGN0ZHd3b3VjcHlvbm9iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3MjQyODYsImV4cCI6MjA4NjMwMDI4Nn0.hchfw9-mNT6qi5Ctbjwm7XcNT1QvzfjqoJ21kXBTHAg"),e={t:document.getElementById('theme-toggle'),m:document.querySelector('.mobile-menu-btn'),n:document.querySelector('.nav-links'),d:document.getElementById('download-modal'),b:document.querySelectorAll('.download-btn'),c:document.querySelectorAll('.modal-close'),tm:document.getElementById('current-time'),cl:document.querySelector('.calendar-days'),j:document.getElementById('join-waitlist'),w:document.getElementById('waitlist-count'),a:document.querySelectorAll('.app-tab'),tc:document.querySelectorAll('.tab-content'),em:document.getElementById('waitlist-email'),sb:document.getElementById('submit-waitlist'),wm:document.getElementById('waitlist-modal'),err:document.getElementById('email-error')},sec={r:new Map(),l:0,s:i=>typeof i!=='string'?i:i.replace(/[<>]/g,'').replace(/javascript:/gi,'').replace(/on\w+=/gi,'').trim().substring(0,500),h:h=>{const d=document.createElement('div');return d.textContent=h,d.innerHTML},cr:(k,l=5,w=6e4)=>{const n=Date.now(),r=sec.r.get(k)||[],rc=r.filter(t=>n-t<w);if(rc.length>=l)return!1;return rc.push(n),sec.r.set(k,rc),!0},ve:em=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(em),vf:f=>/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(f)},fp=()=>{let f=localStorage.getItem('fp');return(!f||!sec.vf(f))&&(f=crypto.randomUUID(),localStorage.setItem('fp',f)),f},uw=async()=>{try{const{count:ct}=await supabase.from('waitlist').select('*',{count:'exact',head:!0});e.w&&typeof ct=='number'&&(e.w.textContent=`${sec.h(ct.toString())} Waitlist Signups`)}catch{}},iw=()=>{if(!e.j)return;if(localStorage.getItem('waitlist_joined'))return e.j.disabled=!0,e.j.textContent="You're on the waitlist ✓",void uw();e.j.addEventListener('click',()=>e.wm.classList.add('active'));e.sb.addEventListener('click',async()=>{const n=Date.now();if(n-sec.l<2e3)return;sec.l=n;const k=`waitlist_${fp()}`;if(!sec.cr(k,3,3e4))return alert('Please wait before trying again');const em=e.em.value.trim();if(!em)return e.err.textContent='Email is required';if(!sec.ve(em))return e.err.textContent='Please enter a valid email';try{const{error:err}=await supabase.from('waitlist').insert({fingerprint:sec.s(fp()),email:sec.s(em),created_at:new Date().toISOString()});if(err)throw err;localStorage.setItem('waitlist_joined','true'),e.j.disabled=!0,e.j.textContent="You're on the waitlist ✓",e.wm.classList.remove('active'),e.em.value='',e.err.textContent='',uw(),alert('Thank you! You are now on the waitlist.')}catch{alert('Failed to join waitlist. Please try again.')}})};

e.t?.addEventListener('click',()=>{const i=e.t.querySelector('i'),d=document.body.classList.toggle('dark-theme');i.className=d?'fas fa-sun':'fas fa-moon',localStorage.setItem('theme',d?'dark':'light')}),localStorage.getItem('theme')==='dark'&&(document.body.classList.add('dark-theme'),e.t?.querySelector('i').className='fas fa-sun'),e.m?.addEventListener('click',()=>{e.n.style.display=e.n.style.display==='flex'?'none':'flex'}),window.addEventListener('resize',()=>{window.innerWidth>768&&e.n&&(e.n.style.display='')}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener('click',e=>{e.preventDefault();const t=document.querySelector(sec.s(a.getAttribute('href')));if(!t)return;e.n&&window.innerWidth<=768&&(e.n.style.display='none'),window.scrollTo({top:t.offsetTop-80,behavior:'smooth'})})}),e.a.forEach(t=>{t.addEventListener('click',()=>{const id=sec.s(t.dataset.tab);e.a.forEach(a=>a.classList.remove('active')),e.tc.forEach(c=>c.classList.remove('active')),t.classList.add('active'),document.getElementById(`${id}-tab`)?.classList.add('active')})});

const uc=()=>{const n=new Date;e.tm&&(e.tm.textContent=`${n.getHours().toString().padStart(2,'0')}:${n.getMinutes().toString().padStart(2,'0')}`)},ic=()=>{if(!e.cl)return;const n=new Date,y=n.getFullYear(),m=n.getMonth(),f=new Date(y,m,1).getDay()||7,d=new Date(y,m+1,0).getDate();let h='';for(let i=1-(f-1);i<=42-(f-1);i++){const c=i<1||i>d?'calendar-day other':i===n.getDate()?'calendar-day today':'calendar-day';h+=`<div class="${sec.h(c)}">${sec.h(((i+d-1)%d+1).toString())}</div>`}e.cl.innerHTML=h;const cm=document.querySelector('.current-month');cm&&(cm.textContent=n.toLocaleDateString('en-US',{month:'long',year:'numeric'}))};

e.b.forEach(b=>{b.addEventListener('click',()=>{sec.cr('download_modal',10,6e4)&&e.d.classList.add('active')})}),e.c.forEach(b=>{b.addEventListener('click',()=>{e.d.classList.remove('active'),e.wm.classList.remove('active')})}),e.d?.addEventListener('click',e=>e.target===e.d&&e.d.classList.remove('active')),e.wm?.addEventListener('click',e=>e.target===e.wm&&e.wm.classList.remove('active'));

document.addEventListener('DOMContentLoaded',()=>{uc(),setInterval(uc,6e4),ic(),iw(),uw(),setInterval(()=>{const n=Date.now();for(const[k,t]of sec.r){const v=t.filter(tt=>n-tt<6e5);v.length===0?sec.r.delete(k):sec.r.set(k,v)}},3e5)}),window.addEventListener('beforeunload',()=>sec.r.clear());
